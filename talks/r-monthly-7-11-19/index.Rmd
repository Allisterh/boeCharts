---
title: "Bank-style data viz made simple"
subtitle: "(with `ggplot2` and `boeCharts`)"
author: "Ewen Henderson"
date: "7/11/2019 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default", "metropolis", "metropolis-fonts", "custom.css"]
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: "%current%"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.width=4.25, fig.height=3.5, fig.retina=3,
                      out.width = "100%",
                      message=FALSE, warning=FALSE, cache = TRUE, 
                      autodep = TRUE, hiline=TRUE)
knitr::opts_hooks$set(fig.callout = function(options) {
  if (options$fig.callout) {
    options$echo <- FALSE
    options$out.height <- "99%"
    options$fig.width <- 16
    options$fig.height <- 8
  }
  options
})
options(
  htmltools.dir.version = FALSE, 
  width = 30,
  max.print = 9999,
  knitr.table.format = "html"
)
as_table <- function(...) knitr::kable(..., format='html', digits = 3)
```

# What's inside?

- `ggplot2`, `boecharts` 101

- `boeCharts` "in the wild"

- Future development

---
layout: false
class: inverse center middle text-white

.font200[*ggplot2*, *boeCharts* 101]

---

# What is *ggplot2*?

.pull-left[

- A long-favoured (10 years young!), opinionated R package that effectively implements the "layered grammar of graphics"

- Advocates for a "declarative" visualisation workflow - you declare relationships between your data's variables and chart aesthetics, it takes care of the finer details (if you don't want to)

- Better explained by it's creator, Hadley Wickham, via the `ggplot2` [book](https://ggplot2-book.org/) and [website](https://ggplot2.tidyverse.org/)

]

.pull-right[
![](images/hadley-cosmo.png_large)
]

.footnote[<https://www.jstatsoft.org/article/view/v017b03/v17b03.pdf>]
]

---

# Why you should use *ggplot2*

.pull-left[

- .h1[Simple] and consistent core API

- Designed with iteration and creativity in mind

- Powerful enough to produce publication-quality plots

- Lots of code and graphics in the public domain

- Core `tidyverse` library (meaning lots of active development) but an open system

- Encourages the practice of tidy data principles
]

.pull-right[
![](images/ft.png)
]

---

# What is *boeCharts*?

.pull-left[

- An internal R package that extends `ggplot2` with Bank-style data viz helpers

- A set of distributed charting "recipes" to aid consistency and save time spent on repetitive tasks (e.g. chart formatting)

- A bridge between our visual identity guidelines and reproducible data visualisation

]

.pull-right[

]

---

# Why you should use *boeCharts*

.pull-left[

- .h1[Simple] and consistent core API, consistent with `ggplot2`

- ~~Lean~~ Fall into the Bank's visual identity guidelines

- Powerful enough to produce Bank publication-quality plots

- Lots of example code and graphics in the Bank

- ...
]

.pull-right[

]

---
layout: false
# Some new tricks

`boeCharts` **v1.1.0** (released this September) brought with it:

- Harmonious/vibrant colour combination palettes, as featured in the Bank's [new visual identity](https://bankofengland.frontify.com/d/RPk6pMZziBFw/bank-standards#/brand-elements/colour-palette)

- Diverging, [ColorBrewer](http://colorbrewer2.org/)-style palettes

- Continuous, ggplot2-supported, scales (these work particularly nicely with new harmonious/vibrant palettes) to complement existing discrete scales

- A [Bank Overground](https://www.bankofengland.co.uk/bank-overground) chart theme (inc. auto font handling)

- Much, much more&trade; (see the packages [NEWS](https://almplatform/tfs/UnmanagedCollection/Shared%20Analytical%20Code/_git/boeCharts?path=%2FNEWS.md&version=GBmaster&_a=contents) file for comprehensive detail)


---
layout: false
class: inverse center middle text-white

.font200[*boeCharts* "in the wild"]

---

# An aside - Burgernomics

Data used in the following examples comes from The Economist's [Big Mac Index](https://www.economist.com/news/2018/07/11/the-big-mac-index), a "lighthearted guide to exchange rates".

```{r, echo=FALSE}
# load readr package
library(readr)
library(dplyr)
library(here)

# read big mac data
big_mac_index <- read_csv(here("talks/r-monthly-7-11-19/data/big-mac-adjusted-index.csv")) %>% 
  filter(date >= "2012-01-01", currency_code %in% c("GBP", "EUR")) %>% 
  select(-iso_a3, -EUR:-CNY)

as_table(big_mac_index)
```

---

# Getting started

Point your package installations commands to Artifactory (run this once):

```{r eval=FALSE}
local({ boe_repos <- list(
  "boe-cran-local-repo" = "https://binarycentral/artifactory/boe-cran-local-repo/",
  "boe-cran-remote-repo" = "https://<USERNAME>:<PASSWORD>@binarycentral/artifactory/boe-cran-remote-repo/"
  )
options(repos = boe_repos)})
```

install `boeCharts`:

```{r eval=FALSE}
install.packages("boeCharts")
```

load `boeCharts` and `ggplot2`:

```{r}
library(boeCharts); library(ggplot2)
```

---

# Pick a palette

.pull-left[

See what's available:

```{r}
palette_names(type = "vibrant")
```

]

.pull-right[

Preview colours in supported palettes:

```{r}
boe_pal(palette = "vibrant_c")
```

]

---
# Try a theme

.pull-left[

`theme_inflation_report()` can be used to approximate [Inflation Report  ](https://www.bankofengland.co.uk/inflation-report/2019/august-2019) chart designs: 

```{r theme-eg, eval=FALSE}
ggplot() +
  theme_inflation_report() #<<
```

`theme_overground()` can be used to create [Bank Overground](https://www.bankofengland.co.uk/bank-overground) charts: 

```{r, eval=FALSE}
ggplot() +
  theme_overground() #<<
```

]

.pull-right[

```{r, theme-eg-out, ref.label='theme-eg', echo=FALSE, out.width="100%"}
```

]

---
# Get help with "last-mile" formatting

.pull-left[

`boe_date_labels()` applies a conditional month-year date label format to axis labels, compatible with `scale_x|y_date()` (from `ggplot2`):

```{r date-label-ex, eval=FALSE}
ggplot(data = big_mac_index) +
  aes(x = date) +
  scale_x_date(
    date_breaks = "6 months", 
    labels = boe_date_labels(), #<<
    expand = expand_scale(
      mult = c(0, .01)
      )
    )

```

]

.pull-right[

```{r, date-label-ex-out, ref.label='date-label-ex', echo=FALSE, out.width="100%"}
```

]


---
layout: true
# All together now
---

.left-code[
```{r first-plot1a, eval=FALSE}
ggplot(data = big_mac_index)
```
]

.right-plot[
```{r first-plot1a-out, ref.label='first-plot1a', echo=FALSE, out.width="100%"}
```
]

---

.left-code[
```{r first-plot1b, eval=FALSE}
ggplot(data = big_mac_index) +
  aes(x = date, y = USD) #<<
```
]

.right-plot[
```{r first-plot1b-out, ref.label='first-plot1b', echo=FALSE, out.width="100%"}
```
]

---

.left-code[
```{r first-plot1c, eval=FALSE}
ggplot(data = big_mac_index) +
  aes(x = date, y = USD) +
  geom_line(size = 0.7) #<<
```
]

.right-plot[
```{r first-plot1c-out, ref.label='first-plot1c', echo=FALSE, out.width="100%"}
```
]

---

.left-code[
```{r first-plot1d, eval=FALSE}
ggplot(data = big_mac_index) +
  aes(x = date, y = USD,
      colour = currency_code) + #<<
  geom_line(size = 1.1) 
```
]

.right-plot[
```{r first-plot1d-out, ref.label='first-plot1d', echo=FALSE, out.width="100%"}
```
]

---

.left-code[
```{r first-plot1e, eval=FALSE}
ggplot(data = big_mac_index) +
  aes(x = date, y = USD,
      colour = currency_code) +
  geom_line(size = 1.1) +
  scale_color_discrete_boe( #<<
    palette = "vibrant_c", #<<
    reverse = TRUE) #<<
```
]

.right-plot[
```{r first-plot1e-out, ref.label='first-plot1e', echo=FALSE, out.width="100%"}
```
]

---

.left-code[
```{r first-plot1f, eval=FALSE}
ggplot(data = big_mac_index) +
  aes(x = date, y = USD,
      colour = currency_code) +
  geom_line(size = 1.1) +
  scale_color_discrete_boe(
    palette = "vibrant_c",
    reverse = TRUE) +
  theme_overground( #<<
    base_size = 16 #<<
  ) #<<
```
]

.right-plot[
```{r first-plot1f-out, ref.label='first-plot1f', echo=FALSE, out.width="100%"}
```
]

---

.left-code[
```{r first-plot1g, eval=FALSE}
ggplot(data = big_mac_index) +
  aes(x = date, y = USD,
      colour = currency_code) +
  geom_line(size = 1.1) +
  scale_color_discrete_boe(
    palette = "vibrant_c",
    reverse = TRUE) +
  theme_overground( 
    base_size = 11, caption_size = 8
  ) +
  labs(
    title = "Big Macs",
    y = "Index (%) relative to USD", x = NULL,
    caption = "Source: https://github.com/TheEconomist/big-mac-data | Index adjusted for GDP"
  )
```
]

.right-plot[
```{r first-plot1g-out, ref.label='first-plot1g', echo=FALSE, out.width="100%"}
```
]

---
layout:false
# Other sightings

.pull-left[

- [Statistical Releases](https://www.bankofengland.co.uk/statistics/money-and-credit/2019/june-2019)

- [Machine learning in UK financial services](https://www.bankofengland.co.uk/report/2019/machine-learning-in-uk-financial-services)

- Internal indicators

![](images/stats-release.png)

]

.pull-right[
![](images/ml-survey.png)
![](images/indicator.png)

]

---
layout: false
class: inverse center middle text-white

.font200[Future development]

---

# The ever-growing wishlist

- Functionality for exporting charts to common destinations (e.g. 16x9 ppt, half-size), with opinionated defaults

- Automatic, direct labelling of line charts

- Theme contributions (or augmentations) from around the Bank

- Better examples of "using grey" (a la [gghighlight](https://yutannihilation.github.io/gghighlight/)) + more "in the wild" examples in general

- Font handling improvements for non-Windows systems (for use on Shiny Server, for example)

- Custom geoms (e.g. fan charts)

---

# How to contribute

.pull-left[
- Find bugs (and report them!)

- Suggest changes or new features

- Share your "in the wild" examples

- For bonus points, why not try and to the package yourself?
    - Read the *Contribute" section of the package [README](https://almplatform/tfs/UnmanagedCollection/Shared%20Analytical%20Code/_git/boeCharts?path=%2FREADME.md&version=GBmaster&_a=contents) to get started
    - [Contact AL Firrell / me](mailto:ewen.henderson@bankofengland.co.uk?subject=boeCharts) if you wanted to discuss anything
    - Take the plunge
]

.pull-right[

![](images/contribute.gif)
]

---
layout: false
class: inverse center middle text-white

.font200[Questions]
